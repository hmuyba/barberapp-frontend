<div class="login-container">
  <div class="login-card">
    <!-- Logo y T√≠tulo -->
    <div class="text-center mb-4">
      <div class="logo-circle">
        <i class="bi bi-scissors"></i>
      </div>
      <h2 class="mt-3 mb-1">BarberApp</h2>
      <p class="text-muted">Sistema de Gesti√≥n de Citas</p>
    </div>

    <!-- Formulario de Login -->
    <form (ngSubmit)="onSubmit()" #loginForm="ngForm">
      <!-- Email -->
      <div class="mb-3">
        <label for="email" class="form-label fw-bold">Correo Electr√≥nico</label>
        <input
          type="email"
          class="form-control"
          id="email"
          name="email"
          [(ngModel)]="credentials.email"
          placeholder="tu@email.com"
          required
          email
          [disabled]="isLoading"
        />
      </div>

      <!-- Contrase√±a -->
      <div class="mb-3">
        <label for="password" class="form-label fw-bold">Contrase√±a</label>
        <div class="input-group">
          <input
            [type]="showPassword ? 'text' : 'password'"
            class="form-control"
            id="password"
            name="password"
            [(ngModel)]="credentials.password"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            required
            [disabled]="isLoading"
          />
          <button
            class="btn btn-outline-secondary"
            type="button"
            (click)="togglePasswordVisibility()"
          >
            <i [class]="showPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
          </button>
        </div>
      </div>

      <!-- Recordarme y Olvid√© contrase√±a -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="remember" />
          <label class="form-check-label" for="remember"> Recordarme </label>
        </div>
        <a
          href="#"
          class="text-decoration-none"
          style="color: var(--primary-color)"
        >
          ¬øOlvidaste tu contrase√±a?
        </a>
      </div>

      <!-- Mensaje de Error -->
      <div
        *ngIf="errorMessage && !show2FAModal"
        class="alert alert-danger"
        role="alert"
      >
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {{ errorMessage }}
      </div>

      <!-- Bot√≥n Iniciar Sesi√≥n -->
      <button
        type="submit"
        class="btn btn-primary w-100 py-2 mb-3"
        [disabled]="isLoading || !loginForm.valid"
      >
        <span *ngIf="!isLoading">Iniciar Sesi√≥n</span>
        <span *ngIf="isLoading">
          <span
            class="spinner-border spinner-border-sm me-2"
            role="status"
          ></span>
          Iniciando...
        </span>
      </button>

      <!-- Link a Registro -->
      <div class="text-center">
        <span class="text-muted">¬øNo tienes cuenta?</span>
        <a
          (click)="goToRegister()"
          class="text-decoration-none ms-2 cursor-pointer"
          style="color: var(--primary-color); cursor: pointer"
        >
          Reg√≠strate aqu√≠
        </a>
      </div>
    </form>
  </div>

  <!-- Usuarios de prueba (solo para desarrollo) -->
  <div class="test-users mt-4">
    <p class="text-center text-muted mb-2">
      <small>üë§ Usuarios de prueba:</small>
    </p>
    <div class="d-flex gap-2 justify-content-center flex-wrap">
      <button
        class="btn btn-sm btn-outline-primary"
        (click)="
          credentials.email = 'cliente@test.com';
          credentials.password = 'Test123!'
        "
      >
        Cliente
      </button>
      <button
        class="btn btn-sm btn-outline-success"
        (click)="
          credentials.email = 'barbero@test.com';
          credentials.password = 'Test123!'
        "
      >
        Barbero
      </button>
      <button
        class="btn btn-sm btn-outline-danger"
        (click)="
          credentials.email = 'admin@barberia.com';
          credentials.password = 'Admin123!'
        "
      >
        Admin
      </button>
    </div>
  </div>
</div>

<!-- Modal 2FA -->
<div class="modal-overlay" *ngIf="show2FAModal" (click)="close2FAModal()">
  <div class="modal-2fa" (click)="$event.stopPropagation()">
    <div class="text-center mb-4">
      <div class="icon-circle">
        <i class="bi bi-shield-lock"></i>
      </div>
      <h4 class="mt-3">Verificaci√≥n en Dos Pasos</h4>
      <p class="text-muted">
        Ingresa el c√≥digo de 6 d√≠gitos enviado a<br />
        <strong>{{ credentials.email }}</strong>
      </p>
    </div>

    <!-- Mensaje de √©xito -->
    <div *ngIf="successMessage" class="alert alert-success py-2">
      <i class="bi bi-check-circle me-2"></i>
      {{ successMessage }}
    </div>

    <!-- Mensaje de error -->
    <div *ngIf="errorMessage" class="alert alert-danger py-2">
      <i class="bi bi-exclamation-triangle me-2"></i>
      {{ errorMessage }}
    </div>

    <!-- Input del c√≥digo -->
    <div class="mb-4">
      <input
        type="text"
        class="form-control form-control-lg text-center code-input"
        [(ngModel)]="twoFactorCode"
        (input)="onCodeInput($event)"
        placeholder="000000"
        maxlength="6"
        [disabled]="isVerifying2FA"
        autofocus
      />
      <small class="text-muted d-block text-center mt-2">
        El c√≥digo expira en 5 minutos
      </small>
    </div>

    <!-- Bot√≥n verificar -->
    <button
      type="button"
      class="btn btn-primary w-100 py-2 mb-3"
      (click)="verify2FA()"
      [disabled]="isVerifying2FA || twoFactorCode.length !== 6"
    >
      <span *ngIf="!isVerifying2FA">
        <i class="bi bi-check-lg me-2"></i>
        Verificar C√≥digo
      </span>
      <span *ngIf="isVerifying2FA">
        <span class="spinner-border spinner-border-sm me-2"></span>
        Verificando...
      </span>
    </button>

    <!-- Reenviar c√≥digo -->
    <div class="text-center">
      <span class="text-muted">¬øNo recibiste el c√≥digo?</span>
      <button
        type="button"
        class="btn btn-link p-0 ms-1"
        (click)="resend2FACode()"
        [disabled]="!canResendCode"
      >
        <span *ngIf="canResendCode">Reenviar</span>
        <span *ngIf="!canResendCode">Reenviar en {{ resendCountdown }}s</span>
      </button>
    </div>

    <!-- Bot√≥n cancelar -->
    <button
      type="button"
      class="btn btn-outline-secondary w-100 mt-3"
      (click)="close2FAModal()"
    >
      Cancelar
    </button>
  </div>
</div>
